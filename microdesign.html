<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microdesign - Planification pédagogique</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'concordia-burgundy': '#912338',
            'concordia-gold': '#FFD700',
            indigo: {
              50: '#fef2f4',
              100: '#fde6ea',
              200: '#f9c0ca',
              300: '#f5949f',
              400: '#d4475a',
              500: '#b52e47',
              600: '#912338',
              700: '#6d1a2a',
              800: '#5a1523',
              900: '#48101c',
              950: '#350c14',
            }
          },
          fontFamily: {
            'display': ['Advent Pro', 'system-ui', 'sans-serif'],
            'body': ['Antic', 'system-ui', 'sans-serif'],
          }
        }
      }
    }
    </script>
    <!-- Bunny Fonts -->
    <link rel="preconnect" href="https://fonts.bunny.net">
    <link href="https://fonts.bunny.net/css?family=advent-pro:400,500,600,700|antic:400" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-slate-50 min-h-screen">
    <!-- Header Mount Point -->
    <div id="app-header-mount"></div>

    <div class="max-w-7xl mx-auto px-4 py-6">
        <!-- Page Header -->
        <header class="mb-8">
            <div class="flex items-center gap-4 mb-4">
                <div class="w-14 h-14 rounded-xl flex items-center justify-center" style="background: linear-gradient(135deg, #912338, #6d1a2a);">
                    <span class="material-icons-round text-white text-2xl">view_timeline</span>
                </div>
                <div>
                    <h1 class="text-3xl font-bold" style="color: #912338; font-family: 'Advent Pro', sans-serif;" data-i18n="micro_title">Microdesign</h1>
                    <p class="text-slate-500" data-i18n="micro_subtitle">planification pédagogique et opérationnelle</p>
                </div>
            </div>

            <!-- SMART Objectives Help -->
            <div class="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6">
                <div class="flex items-start gap-3">
                    <span class="material-icons-round text-amber-600">tips_and_updates</span>
                    <div>
                        <p class="text-sm text-amber-800" data-i18n="help_smart_objectives">
                            Un objectif SMART est un cadre qui définit des objectifs d'apprentissage spécifiques, mesurables, atteignables, pertinents et limités dans le temps afin de transformer des intentions pédagogiques vagues en résultats observables, assurant ainsi un alignement rigoureux entre le contenu enseigné et l'évaluation des compétences.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Toolbar -->
            <div class="flex flex-wrap gap-3">
                <div class="flex items-center bg-white border border-slate-200 rounded-xl p-1.5 gap-1 shadow-sm">
                    <button onclick="microSaveState()" class="text-slate-600 hover:text-emerald-600 hover:bg-emerald-50 px-3 py-2 rounded-lg transition-colors flex items-center gap-2" title="Sauvegarder">
                        <span class="material-icons-round text-xl">save</span>
                        <span class="text-sm font-semibold hidden md:inline" data-i18n="btn_save">sauvegarder</span>
                    </button>
                    <button onclick="microLoadState()" class="text-slate-600 hover:text-sky-600 hover:bg-sky-50 px-3 py-2 rounded-lg transition-colors flex items-center gap-2" title="Charger">
                        <span class="material-icons-round text-xl">folder_open</span>
                        <span class="text-sm font-semibold hidden md:inline" data-i18n="btn_load">charger</span>
                    </button>
                    <input id="micro-load-input" type="file" accept="application/json" class="hidden" onchange="microLoadFromFile(event)">
                    <div class="w-px bg-slate-200 h-6 mx-1"></div>
                    <button onclick="microExportMarkdown()" class="text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 px-3 py-2 rounded-lg transition-colors flex items-center gap-2" title="Exporter">
                        <span class="material-icons-round text-xl">description</span>
                        <span class="text-sm font-semibold hidden md:inline" data-i18n="btn_export">exporter</span>
                    </button>
                </div>

                <!-- Language selector -->
                <div class="flex items-center bg-white border border-slate-200 rounded-xl p-1.5 gap-1 shadow-sm">
                    <select id="micro-lang-select" onchange="microSwitchLang(this.value)" class="text-sm text-slate-600 bg-transparent border-none focus:outline-none cursor-pointer px-2 py-1">
                        <option value="fr">Français</option>
                        <option value="en-CA">English (CA)</option>
                    </select>
                </div>
            </div>
        </header>

        <!-- Global Units Control -->
        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-4 mb-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <span class="material-icons-round text-concordia-burgundy">folder_special</span>
                    <span class="font-bold text-slate-700" data-i18n="micro_num_units">nombre d'unités</span>
                </div>
                <div class="flex items-center gap-2">
                    <button type="button" class="qty-btn" onclick="microUnitDec()">−</button>
                    <input type="number" id="num-units-global" class="qty-input w-16 text-center" value="2" min="1" max="10">
                    <button type="button" class="qty-btn" onclick="microUnitInc()">+</button>
                </div>
            </div>
        </div>

        <!-- Units Container -->
        <div id="units-container" class="space-y-6">
            <!-- Units will be rendered here -->
        </div>

    </div>

    <!-- Templates -->
    <template id="micro-unit-template">
        <div class="micro-unit-card bg-white rounded-2xl shadow-sm border-2 border-slate-200 overflow-hidden">
            <!-- Unit Header -->
            <div class="micro-unit-header p-4 border-b border-slate-100" style="background: linear-gradient(135deg, rgba(145,35,56,0.05), rgba(145,35,56,0.02));">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3 flex-1">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center font-bold text-white micro-unit-index" style="background: linear-gradient(135deg, #912338, #6d1a2a);">1</div>
                        <div class="flex-1">
                            <input type="text" class="micro-unit-title w-full text-lg font-bold text-slate-800 bg-transparent border-b border-transparent hover:border-slate-300 focus:border-concordia-burgundy outline-none" placeholder="Titre de l'unité (ex: Introduction aux concepts)" data-i18n-placeholder="micro_ph_unit">
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button class="text-slate-400 hover:text-concordia-burgundy p-2 transition-colors" onclick="toggleMicroUnit(this)" title="Replier/Déplier">
                            <span class="material-icons-round">expand_less</span>
                        </button>
                        <button class="text-slate-400 hover:text-red-500 p-2 transition-colors" onclick="deleteMicroUnit(this)" title="Supprimer">
                            <span class="material-icons-round">delete_outline</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Unit Body -->
            <div class="micro-unit-body p-4">
                <!-- Enabling Objectives Section -->
                <div class="mb-4">
                    <label class="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                        <span class="material-icons-round text-sm text-concordia-burgundy">flag</span>
                        <span data-i18n="micro_enabling_objectives">objectifs d'apprentissage de l'apprenant</span>
                    </label>
                    <div class="micro-unit-objectives mt-2 space-y-2">
                        <!-- Objectives will be added here -->
                    </div>
                    <button type="button" class="mt-2 text-sm text-concordia-burgundy hover:text-concordia-burgundy/80 flex items-center gap-1" onclick="addMicroObjective(this, 'unit')">
                        <span class="material-icons-round text-sm">add</span>
                        <span data-i18n="btn_add_objective">ajouter un objectif</span>
                    </button>
                </div>

                <!-- Lessons Control -->
                <div class="flex items-center justify-between bg-slate-50 rounded-lg p-3 mb-4">
                    <span class="text-sm font-semibold text-slate-600" data-i18n="micro_num_lessons">nombre de leçons</span>
                    <div class="flex items-center gap-2">
                        <button type="button" class="qty-btn-inline" onclick="microLessonDec(this)">−</button>
                        <input type="number" class="num-lessons qty-input-inline" value="2" min="0" max="20">
                        <button type="button" class="qty-btn-inline" onclick="microLessonInc(this)">+</button>
                    </div>
                </div>

                <!-- Lessons Container -->
                <div class="lessons-container space-y-4 ml-4 border-l-2 border-slate-200 pl-4">
                    <!-- Lessons will be rendered here -->
                </div>
            </div>
        </div>
    </template>

    <template id="lesson-template">
        <div class="lesson-card bg-slate-50 rounded-xl border border-slate-200 overflow-hidden">
            <!-- Lesson Header -->
            <div class="lesson-header p-3 border-b border-slate-200 bg-white">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2 flex-1">
                        <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center font-bold text-indigo-700 text-sm lesson-index">1.1</div>
                        <input type="text" class="lesson-title flex-1 text-sm font-semibold text-slate-700 bg-transparent border-b border-transparent hover:border-slate-300 focus:border-concordia-burgundy outline-none" placeholder="Titre de la leçon (ex: Séance 1 - Découverte)" data-i18n-placeholder="micro_ph_lesson">
                        <div class="flex items-center gap-1 text-xs text-slate-400">
                            <span class="material-icons-round text-sm">schedule</span>
                            <input type="number" class="lesson-duration w-12 text-center border border-slate-200 rounded px-1 py-0.5 text-xs" value="60" min="5" max="480" title="Durée en minutes">
                            <span>min</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-1">
                        <button class="text-slate-400 hover:text-concordia-burgundy p-1 transition-colors" onclick="toggleLesson(this)" title="Replier/Déplier">
                            <span class="material-icons-round text-lg">expand_less</span>
                        </button>
                        <button class="text-slate-400 hover:text-red-500 p-1 transition-colors" onclick="deleteLesson(this)" title="Supprimer">
                            <span class="material-icons-round text-lg">delete_outline</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Lesson Body -->
            <div class="lesson-body p-3">
                <!-- Instructional Events Hint -->
                <div class="text-xs text-slate-400 italic mb-3 flex items-center gap-1">
                    <span class="material-icons-round text-sm">info</span>
                    <span data-i18n="micro_gagne_hint">Pensez aux 9 événements de Gagné : attention, objectifs, prérequis, contenu, guidance, pratique, feedback, évaluation, transfert</span>
                </div>

                <!-- Activities Control -->
                <div class="flex items-center justify-between bg-white rounded-lg p-2 mb-3">
                    <span class="text-xs font-semibold text-slate-500" data-i18n="micro_num_activities">nombre d'activités</span>
                    <div class="flex items-center gap-1">
                        <button type="button" class="qty-btn-inline-sm" onclick="microActivityDec(this)">−</button>
                        <input type="number" class="num-activities qty-input-inline-sm" value="3" min="0" max="20">
                        <button type="button" class="qty-btn-inline-sm" onclick="microActivityInc(this)">+</button>
                    </div>
                </div>

                <!-- Activities Container -->
                <div class="activities-container space-y-2">
                    <!-- Activities will be rendered here -->
                </div>
            </div>
        </div>
    </template>

    <template id="activity-template">
        <div class="activity-card bg-white rounded-lg border border-slate-200 p-3">
            <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-2 flex-1">
                    <div class="w-6 h-6 rounded-full bg-emerald-100 flex items-center justify-center font-bold text-emerald-700 text-[10px] activity-index">1.1.1</div>
                    <input type="text" class="activity-title flex-1 text-xs font-medium text-slate-600 bg-transparent border-b border-transparent hover:border-slate-300 focus:border-concordia-burgundy outline-none" placeholder="Titre de l'activité" data-i18n-placeholder="micro_ph_activity">
                    <select class="activity-type text-[10px] border border-slate-200 rounded px-1 py-0.5 bg-slate-50">
                        <option value="absorb" data-i18n="opt_absorb">absorb (lire, écouter)</option>
                        <option value="do" data-i18n="opt_do">do (pratiquer)</option>
                        <option value="connect" data-i18n="opt_connect">connect (réfléchir)</option>
                    </select>
                </div>
                <button class="text-slate-400 hover:text-red-500 p-1 transition-colors" onclick="deleteActivity(this)" title="Supprimer">
                    <span class="material-icons-round text-sm">close</span>
                </button>
            </div>

            <!-- Activity Description -->
            <textarea class="activity-description w-full px-2 py-1 text-[11px] border border-slate-100 rounded focus:ring-1 focus:ring-concordia-burgundy/20 outline-none resize-y bg-slate-50 mb-2" rows="2" placeholder="Description de l'activité..." data-i18n-placeholder="micro_ph_activity_desc"></textarea>

            <!-- Media Elements Control -->
            <div class="flex items-center justify-between bg-slate-50 rounded p-2">
                <span class="text-[10px] font-semibold text-slate-400" data-i18n="micro_num_media">éléments médias</span>
                <div class="flex items-center gap-1">
                    <button type="button" class="w-5 h-5 rounded bg-slate-200 text-slate-600 hover:bg-concordia-burgundy hover:text-white text-xs font-bold" onclick="microMediaDec(this)">−</button>
                    <input type="number" class="num-media w-8 text-center text-[10px] border border-slate-200 rounded" value="2" min="0" max="10">
                    <button type="button" class="w-5 h-5 rounded bg-slate-200 text-slate-600 hover:bg-concordia-burgundy hover:text-white text-xs font-bold" onclick="microMediaInc(this)">+</button>
                </div>
            </div>

            <!-- Media Container -->
            <div class="media-container mt-2 space-y-1">
                <!-- Media elements will be rendered here -->
            </div>
        </div>
    </template>

    <template id="media-template">
        <div class="media-item flex items-center gap-2 p-1.5 bg-slate-50 rounded border border-slate-100">
            <select class="media-type text-[10px] border border-slate-200 rounded px-1 py-0.5 bg-white w-20">
                <option value="text" data-i18n="opt_media_text">texte</option>
                <option value="image" data-i18n="opt_media_image">image</option>
                <option value="video" data-i18n="opt_media_video">vidéo</option>
                <option value="audio" data-i18n="opt_media_audio">audio</option>
                <option value="interactive" data-i18n="opt_media_interactive">interactif</option>
            </select>
            <input type="text" class="media-description flex-1 text-[10px] border border-slate-100 rounded px-1 py-0.5 bg-white" placeholder="Description du média..." data-i18n-placeholder="micro_ph_media">
            <button class="text-slate-400 hover:text-red-500" onclick="deleteMedia(this)">
                <span class="material-icons-round text-xs">close</span>
            </button>
        </div>
    </template>

    <!-- Objective Template -->
    <template id="micro-objective-template">
        <div class="micro-objective-item bg-slate-50 rounded-lg p-3 border border-slate-200">
            <div class="flex items-start gap-2">
                <div class="flex-1 space-y-2">
                    <textarea class="micro-objective-text w-full px-2 py-1.5 text-sm border border-slate-200 rounded focus:ring-1 focus:ring-concordia-burgundy/20 outline-none resize-y bg-white" rows="2" placeholder="À la fin de cette unité, l'apprenant sera capable de..." data-i18n-placeholder="micro_ph_objective"></textarea>
                    <div class="flex flex-wrap gap-2">
                        <select class="micro-taxonomy-select text-xs border border-slate-200 rounded px-2 py-1 bg-white focus:ring-1 focus:ring-concordia-burgundy/20 outline-none" onchange="updateMicroTaxonomyLevels(this)">
                            <option value="" data-i18n="opt_select_taxonomy">-- taxonomie --</option>
                            <option value="cognitive" data-i18n="opt_cognitive">cognitif (Bloom)</option>
                            <option value="affective" data-i18n="opt_affective">affectif</option>
                            <option value="psychomotor" data-i18n="opt_psychomotor">psychomoteur</option>
                        </select>
                        <select class="micro-level-select text-xs border border-slate-200 rounded px-2 py-1 bg-white focus:ring-1 focus:ring-concordia-burgundy/20 outline-none" onchange="showMicroVerbsForLevel(this)">
                            <option value="" data-i18n="opt_select_level">-- niveau --</option>
                        </select>
                    </div>
                    <div class="micro-verbs-display hidden text-xs text-slate-500 italic p-2 bg-white rounded border border-dashed border-slate-200">
                        <span class="font-semibold" data-i18n="label_suggested_verbs">verbes suggérés :</span>
                        <span class="micro-verbs-list"></span>
                    </div>
                </div>
                <button class="text-slate-400 hover:text-red-500 p-1 transition-colors" onclick="deleteMicroObjective(this)" title="Supprimer">
                    <span class="material-icons-round text-sm">close</span>
                </button>
            </div>
        </div>
    </template>

    <!-- Footer Mount Point -->
    <div id="app-footer-mount"></div>

    <!-- Scripts -->
    <script src="js/i18n-core.js"></script>
    <script src="js/microdesign.js"></script>
    <script src="js/components-loader.js" defer></script>
</body>
</html>
